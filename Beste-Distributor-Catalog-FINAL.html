<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Beste Distributor Catalog</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:#f5f5f5;color:#333}
.header{background:linear-gradient(135deg,#2b8a8a,#1e6b6b);color:#fff;text-align:center;padding:20px}
.container{max-width:1200px;margin:20px auto;padding:0 20px}
.toolbar{display:flex;gap:10px;justify-content:center;margin-bottom:20px;flex-wrap:wrap}
.btn{padding:10px 20px;border:none;border-radius:6px;font-weight:600;cursor:pointer}
.btn-primary{background:#2b8a8a;color:#fff}
.btn-danger{background:#dc3545;color:#fff}
.products-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px}
.product-card{background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,.1)}
.product-image{height:180px;background:#eee}
.product-image img{width:100%;height:100%;object-fit:cover}
.product-info{padding:15px}
.product-name{font-weight:700;color:#2b8a8a}
.product-price{font-size:20px;font-weight:bold;margin:8px 0}
.old-price{text-decoration:line-through;color:#999}
.badge{background:#28a745;color:#fff;font-size:11px;padding:3px 8px;border-radius:4px}
.product-actions{display:flex;gap:8px;margin-top:10px}
.whatsapp{background:#25D366;color:#fff;padding:8px;border-radius:5px;text-align:center;font-size:13px;font-weight:bold;text-decoration:none}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);align-items:center;justify-content:center;z-index:1000}
.modal.active{display:flex}
.modal-content{background:#fff;padding:25px;border-radius:8px;width:90%;max-width:500px}
.form-group{margin-bottom:15px}
.form-group label{display:block;font-weight:600;margin-bottom:5px}
.form-group input,.form-group select,.form-group textarea{width:100%;padding:10px;border-radius:6px;border:1px solid #ddd}
.modal-actions{display:flex;gap:10px}
</style>
</head>

<body>

<div class="header">
<h1>Beste Distributor</h1>
<p>Product Catalog</p>
</div>

<div class="container">

<div class="toolbar">
<button class="btn btn-primary" onclick="openProduct()">+ Add Product</button>
<button class="btn btn-primary" onclick="openCategory()">ðŸ“‚ Categories</button>
</div>

<div class="products-grid" id="grid"></div>
</div>

<!-- PRODUCT MODAL -->
<div class="modal" id="productModal">
<div class="modal-content">
<h3 id="modalTitle">Add Product</h3>
<div class="form-group"><label>Name</label><input id="name"></div>
<div class="form-group"><label>Category</label><select id="category"></select></div>
<div class="form-group"><label>Price</label><input type="number" id="price"></div>
<div class="form-group"><label>Previous Price</label><input type="number" id="prev"></div>
<div class="modal-actions">
<button class="btn btn-primary" onclick="saveProduct()">Save</button>
<button class="btn" onclick="closeProduct()">Cancel</button>
</div>
</div>
</div>

<!-- CATEGORY MODAL -->
<div class="modal" id="catModal">
<div class="modal-content">
<h3>Categories</h3>
<div id="catList"></div>
<input id="newCat" placeholder="New category">
<button class="btn btn-primary" onclick="addCategory()">Add</button>
<button class="btn" onclick="closeCategory()">Done</button>
</div>
</div>

<script type="module">
import {initializeApp} from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import {getDatabase,ref,onValue,set,remove} from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";

const firebaseConfig={
 apiKey:"AIzaSyBK9-eeQ0E7ovI88jcmk9aa10GWpI9V30U",
 authDomain:"beste-distributor.firebaseapp.com",
 databaseURL:"https://beste-distributor-default-rtdb.firebaseio.com",
 projectId:"beste-distributor",
 storageBucket:"beste-distributor.firebasestorage.app",
 messagingSenderId:"384320855826",
 appId:"1:384320855826:web:349cfb70dae242f0f19dcb"
};

const app=initializeApp(firebaseConfig);
const db=getDatabase(app);

let editId=null;
let categories=[];

/* LOAD CATEGORIES */
onValue(ref(db,'categories'),s=>{
 categories=s.exists()?Object.values(s.val()):["General"];
 renderCats();
});

/* LOAD PRODUCTS */
onValue(ref(db,'products'),s=>{
 const g=document.getElementById('grid');
 g.innerHTML='';
 s.forEach(c=>{
  const p=c.val();
  const disc=p.prevPrice&&p.prevPrice>p.price;
  const wa=`https://wa.me/14372600437?text=${encodeURIComponent(`Interested in ${p.name} - $${p.price}`)}`;
  g.innerHTML+=`
  <div class="product-card">
   <div class="product-image"></div>
   <div class="product-info">
    <div class="product-name">${p.name}</div>
    ${disc?`<div class="old-price">$${p.prevPrice}</div>`:''}
    <div class="product-price">$${p.price} ${disc?'<span class="badge">DISCOUNT</span>':''}</div>
    <a class="whatsapp" href="${wa}" target="_blank">Order on WhatsApp</a>
    <div class="product-actions">
     <button onclick="editProduct('${c.key}')">Edit</button>
     <button onclick="delProduct('${c.key}')">Delete</button>
    </div>
   </div>
  </div>`;
 });
});

window.openProduct=()=>{editId=null;document.getElementById('productModal').classList.add('active')}
window.closeProduct=()=>document.getElementById('productModal').classList.remove('active')

window.saveProduct=()=>{
 const p={
  name:name.value,
  category:category.value,
  price:+price.value,
  prevPrice:prev.value?+prev.value:null
 };
 set(ref(db,'products/'+(editId||Date.now())),p);
 closeProduct();
};

window.editProduct=id=>{
 editId=id;
 onValue(ref(db,'products/'+id),s=>{
  const p=s.val();
  name.value=p.name;category.value=p.category;
  price.value=p.price;prev.value=p.prevPrice||'';
 });
 openProduct();
};

window.delProduct=id=>confirm('Delete?')&&remove(ref(db,'products/'+id));

window.openCategory=()=>{catModal.classList.add('active');renderCats()}
window.closeCategory=()=>catModal.classList.remove('active')

function renderCats(){
 category.innerHTML='';
 catList.innerHTML='';
 categories.forEach((c,i)=>{
  category.innerHTML+=`<option>${c}</option>`;
  catList.innerHTML+=`<div>${c} <button onclick="removeCat(${i})">x</button></div>`;
 });
 set(ref(db,'categories'),categories);
}

window.addCategory=()=>{categories.push(newCat.value);newCat.value='';renderCats()}
window.removeCat=i=>{categories.splice(i,1);renderCats()}
</script>

</body>
</html>
