<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Beste Distributor - Product Catalog</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:#f5f5f5;color:#333}
.header{background:linear-gradient(135deg,#2b8a8a,#1e6b6b);color:#fff;text-align:center;padding:20px;box-shadow:0 2px 10px rgba(0,0,0,0.1)}
.header h1{font-size:28px;margin-bottom:5px}
.header p{font-size:14px;opacity:0.9}
.contact-info{font-size:12px;margin-top:10px;opacity:0.8}
.contact-info a{color:#fff;text-decoration:none;margin:0 10px}
.container{max-width:1200px;margin:20px auto;padding:0 20px}
.toolbar{display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap;justify-content:center}
.btn{padding:10px 20px;border:none;border-radius:6px;cursor:pointer;font-size:14px;font-weight:600;transition:all 0.3s ease}
.btn-primary{background:#2b8a8a;color:#fff}
.btn-primary:hover{background:#1e6b6b;transform:translateY(-2px);box-shadow:0 4px 12px rgba(43,138,138,0.3)}
.btn-secondary{background:#fff;color:#2b8a8a;border:2px solid #2b8a8a}
.btn-secondary:hover{background:#f0f0f0}
.btn-danger{background:#dc3545;color:#fff}
.btn-danger:hover{background:#c82333}
.sync-status{text-align:center;padding:10px;margin-bottom:15px;border-radius:6px;font-size:14px;font-weight:500}
.sync-status.synced{background:#d4edda;color:#155724}
.sync-status.syncing{background:#fff3cd;color:#856404}
.sync-status.error{background:#f8d7da;color:#721c24}
.search-filter{display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap}
.search-filter input,.search-filter select{padding:10px 15px;border:1px solid #ddd;border-radius:6px;font-size:14px;flex:1;min-width:150px}
.products-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px;margin-bottom:40px}
.product-card{background:#fff;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.1);overflow:hidden;transition:all 0.3s ease}
.product-card:hover{box-shadow:0 4px 16px rgba(0,0,0,0.15);transform:translateY(-4px)}
.product-image{width:100%;height:180px;background:#f0f0f0;overflow:hidden;display:flex;align-items:center;justify-content:center}
.product-image img{width:100%;height:100%;object-fit:cover}
.product-placeholder{color:#999;font-size:12px}
.product-info{padding:15px}
.product-name{font-size:16px;font-weight:600;margin-bottom:8px;color:#2b8a8a}
.product-details{font-size:13px;color:#666;margin-bottom:10px}
.product-price{font-size:20px;font-weight:700;color:#2b8a8a;margin-bottom:10px}
.old-price{text-decoration:line-through;color:#999;font-size:14px;margin-bottom:5px}
.badge{display:inline-block;background:#28a745;color:#fff;font-size:11px;padding:3px 8px;border-radius:4px;margin-left:6px}
.product-actions{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
.product-actions button{flex:1;padding:8px;border:none;border-radius:4px;cursor:pointer;font-size:12px;font-weight:600;transition:all 0.2s ease}
.product-actions .btn-edit{background:#2b8a8a;color:#fff;min-width:60px}
.product-actions .btn-delete{background:#dc3545;color:#fff;min-width:60px}
.modal{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:1000;align-items:center;justify-content:center}
.modal.active{display:flex}
.modal-content{background:#fff;padding:30px;border-radius:8px;max-width:500px;width:90%;max-height:90vh;overflow-y:auto;box-shadow:0 4px 20px rgba(0,0,0,0.3)}
.modal-content h2{margin-bottom:20px;color:#2b8a8a}
.form-group{margin-bottom:15px}
.form-group label{display:block;margin-bottom:5px;font-weight:600;font-size:14px;color:#333}
.form-group input,.form-group textarea,.form-group select{width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;font-size:14px;font-family:inherit}
.form-group textarea{resize:vertical;min-height:80px}
.form-group input:focus,.form-group textarea:focus,.form-group select:focus{outline:0;border-color:#2b8a8a;box-shadow:0 0 0 3px rgba(43,138,138,0.1)}
.modal-actions{display:flex;gap:10px;margin-top:20px}
.modal-actions button{flex:1;padding:12px;border:none;border-radius:6px;cursor:pointer;font-weight:600;font-size:14px;transition:all 0.2s ease}
.modal-actions .btn-save{background:#2b8a8a;color:#fff}
.modal-actions .btn-save:hover{background:#1e6b6b}
.modal-actions .btn-cancel{background:#f0f0f0;color:#333}
.modal-actions .btn-cancel:hover{background:#e0e0e0}
.no-products{text-align:center;padding:40px;color:#999}
.category-item{display:flex;justify-content:space-between;align-items:center;padding:10px;background:#f9f9f9;border-radius:6px;margin-bottom:8px}
@media (max-width:768px){
  .header h1{font-size:22px}
  .products-grid{grid-template-columns:1fr}
  .toolbar{flex-direction:column}
  .search-filter{flex-direction:column}
  .search-filter input,.search-filter select{width:100%}
  .modal-content{width:95%;padding:20px}
}
</style>
</head>

<body>

<div class="header">
<h1>Beste Distributor</h1>
<p>Shop smarter, Save more, Delivered fast</p>
<div class="contact-info">
<a href="tel:4372600437">(437) 260-0437</a>
<a href="mailto:bestedistributor.ca@gmail.com">bestedistributor.ca@gmail.com</a>
</div>
</div>

<div class="container">
<div class="sync-status synced" id="syncStatus">‚úì Connected to Firebase</div>

<div class="toolbar">
<button class="btn btn-primary" onclick="openAddModal()">+ Add Product</button>
<button class="btn btn-secondary" onclick="openCategoryModal()">üìÇ Manage Categories</button>
<button class="btn btn-secondary" onclick="exportPDF()">üìÑ Professional Catalog</button>
<button class="btn btn-secondary" onclick="exportCSV()">üìä Export CSV</button>
<button class="btn btn-secondary" onclick="importCSV()">üì• Import CSV</button>
</div>

<div class="search-filter">
<input type="text" id="searchInput" placeholder="Search products..." onkeyup="filterProducts()">
<select id="categoryFilter" onchange="filterProducts()">
<option value="">All Categories</option>
</select>
</div>

<div class="products-grid" id="productsGrid">
<div class="no-products">No products yet. Add your first product!</div>
</div>
</div>

<!-- PRODUCT MODAL -->
<div class="modal" id="productModal">
<div class="modal-content">
<h2 id="modalTitle">Add Product</h2>
<form id="productForm" onsubmit="saveProduct(event)">
<div class="form-group">
<label>Product Name *</label>
<input type="text" id="productName" required>
</div>

<div class="form-group">
<label>Category</label>
<select id="productCategory"></select>
</div>

<div class="form-group">
<label>Price *</label>
<input type="number" id="productPrice" step="0.01" required>
</div>

<div class="form-group">
<label>Previous Price (for discount)</label>
<input type="number" id="productPrevPrice" step="0.01">
</div>

<div class="form-group">
<label>Description</label>
<textarea id="productDescription" placeholder="Product description..."></textarea>
</div>

<div class="form-group">
<label>Product Image</label>
<input type="file" id="productImage" accept="image/*" onchange="previewImage()">
<img id="imagePreview" style="width:100%;max-height:200px;margin-top:10px;border-radius:6px;object-fit:cover;display:none;">
</div>

<div class="modal-actions">
<button type="submit" class="btn-save">Save Product</button>
<button type="button" class="btn-cancel" onclick="closeModal()">Cancel</button>
</div>
</form>
</div>
</div>

<!-- CATEGORY MODAL -->
<div class="modal" id="categoryModal">
<div class="modal-content">
<h2>Manage Categories</h2>
<div id="categoriesList" style="margin-bottom:20px;max-height:400px;overflow-y:auto;"></div>
<div class="form-group">
<label>Add New Category</label>
<div style="display:flex;gap:10px;">
<input type="text" id="newCategoryName" placeholder="Enter category name" style="flex:1;">
<button class="btn btn-primary" onclick="addCategory()" style="padding:10px 20px;">Add</button>
</div>
</div>
<div class="modal-actions">
<button type="button" class="btn-cancel" onclick="closeCategoryModal()" style="flex:1;">Done</button>
</div>
</div>
</div>

<!-- FILE INPUT -->
<input type="file" id="csvInput" accept=".csv" style="display:none" onchange="handleCSVImport()">

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getDatabase, ref, onValue, set, remove, get } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";
import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-storage.js";

const firebaseConfig = {
 apiKey: "AIzaSyBK9-eeQ0E7ovI88jcmk9aa10GWpI9V30U",
 authDomain: "beste-distributor.firebaseapp.com",
 databaseURL: "https://beste-distributor-default-rtdb.firebaseio.com",
 projectId: "beste-distributor",
 storageBucket: "beste-distributor.firebasestorage.app",
 messagingSenderId: "384320855826",
 appId: "1:384320855826:web:349cfb70dae242f0f19dcb"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const storage = getStorage(app);

let products = [];
let categories = [];
let editingId = null;
let currentImageFile = null;

const defaultCategories = ["Beverages", "Snacks", "Candy", "Tobacco", "Grocery", "Dairy", "Frozen Foods", "Health & Beauty", "Household", "Other"];

window.addEventListener('load', () => {
 loadCategories();
 loadProducts();
});

function loadCategories(){
 const catRef = ref(db, 'categories');
 onValue(catRef, snap => {
  if(snap.exists()) categories = Object.values(snap.val());
  else {
   categories = defaultCategories;
   set(catRef, categories);
  }
  updateCategorySelects();
 });
}

function loadProducts(){
 const prodRef = ref(db, 'products');
 onValue(prodRef, snap => {
  products = [];
  snap.forEach(c => products.push({id: c.key, ...c.val()}));
  renderProducts();
  updateSyncStatus('Synced');
 }, err => {
  console.error('Error:', err);
  updateSyncStatus('Error');
 });
}

window.openAddModal = () => {
 editingId = null;
 document.getElementById('modalTitle').textContent = 'Add Product';
 document.getElementById('productForm').reset();
 document.getElementById('imagePreview').style.display = 'none';
 currentImageFile = null;
 document.getElementById('productModal').classList.add('active');
};

window.closeModal = () => {
 document.getElementById('productModal').classList.remove('active');
 currentImageFile = null;
};

window.previewImage = () => {
 const file = document.getElementById('productImage').files[0];
 if(file){
  currentImageFile = file;
  const reader = new FileReader();
  reader.onload = e => {
   const preview = document.getElementById('imagePreview');
   preview.src = e.target.result;
   preview.style.display = 'block';
  };
  reader.readAsDataURL(file);
 }
};

window.saveProduct = async e => {
 e.preventDefault();
 updateSyncStatus('Syncing');

 const data = {
  name: document.getElementById('productName').value,
  category: document.getElementById('productCategory').value,
  price: parseFloat(document.getElementById('productPrice').value),
  prevPrice: document.getElementById('productPrevPrice').value ? parseFloat(document.getElementById('productPrevPrice').value) : null,
  description: document.getElementById('productDescription').value,
  image: ''
 };

 try{
  if(currentImageFile){
   const imgRef = storageRef(storage, `products/${Date.now()}_${currentImageFile.name}`);
   await uploadBytes(imgRef, currentImageFile);
   data.image = await getDownloadURL(imgRef);
  }

  if(editingId){
   await set(ref(db, `products/${editingId}`), data);
  } else {
   await set(ref(db, `products/${Date.now()}`), data);
  }
  closeModal();
  updateSyncStatus('Synced');
 }catch(err){
  console.error('Save error:', err);
  updateSyncStatus('Error');
  alert('Error: ' + err.message);
 }
};

window.editProduct = id => {
 const prod = products.find(p => p.id === id);
 if(!prod) return;

 editingId = id;
 document.getElementById('modalTitle').textContent = 'Edit Product';
 document.getElementById('productName').value = prod.name;
 document.getElementById('productCategory').value = prod.category || '';
 document.getElementById('productPrice').value = prod.price;
 document.getElementById('productPrevPrice').value = prod.prevPrice || '';
 document.getElementById('productDescription').value = prod.description || '';

 if(prod.image){
  const preview = document.getElementById('imagePreview');
  preview.src = prod.image;
  preview.style.display = 'block';
 }

 document.getElementById('productModal').classList.add('active');
};

window.deleteProduct = id => {
 if(!confirm('Delete this product?')) return;
 updateSyncStatus('Syncing');
 remove(ref(db, `products/${id}`)).then(() => {
  updateSyncStatus('Synced');
 }).catch(err => {
  updateSyncStatus('Error');
 });
};

function renderProducts(){
 const grid = document.getElementById('productsGrid');
 const search = (document.getElementById('searchInput').value || '').toLowerCase();
 const catFilter = document.getElementById('categoryFilter').value;

 let filtered = products.filter(p => {
  const matchSearch = p.name.toLowerCase().includes(search);
  const matchCat = !catFilter || p.category === catFilter;
  return matchSearch && matchCat;
 });

 if(filtered.length === 0){
  grid.innerHTML = '<div class="no-products">No products found.</div>';
  return;
 }

 grid.innerHTML = filtered.map(p => {
  const discounted = p.prevPrice && p.prevPrice > p.price;
  return `
   <div class="product-card">
    <div class="product-image">
     ${p.image ? `<img src="${p.image}" alt="${p.name}">` : '<div class="product-placeholder">No Image</div>'}
    </div>
    <div class="product-info">
     <div class="product-name">${p.name}</div>
     <div class="product-details">${p.category || ''}</div>
     ${discounted ? `<div class="old-price">$${p.prevPrice.toFixed(2)}</div>` : ''}
     <div class="product-price">$${p.price.toFixed(2)} ${discounted ? '<span class="badge">DISCOUNT</span>' : ''}</div>
     ${p.description ? `<div class="product-details" style="margin-top:10px;">${p.description}</div>` : ''}
     <div class="product-actions">
      <button class="btn-edit" onclick="editProduct('${p.id}')">Edit</button>
      <button class="btn-delete" onclick="deleteProduct('${p.id}')">Delete</button>
     </div>
    </div>
   </div>`;
 }).join('');
}

window.filterProducts = renderProducts;

function updateCategorySelects(){
 const selects = document.querySelectorAll('#productCategory, #categoryFilter');
 selects.forEach(sel => {
  const val = sel.value;
  sel.innerHTML = sel.id === 'categoryFilter' ? '<option value="">All Categories</option>' : '';
  categories.forEach(cat => {
   const opt = document.createElement('option');
   opt.value = cat;
   opt.textContent = cat;
   sel.appendChild(opt);
  });
  sel.value = val;
 });
}

window.openCategoryModal = () => {
 document.getElementById('categoryModal').classList.add('active');
 renderCategoryList();
};

window.closeCategoryModal = () => {
 document.getElementById('categoryModal').classList.remove('active');
};

function renderCategoryList(){
 const list = document.getElementById('categoriesList');
 list.innerHTML = categories.map((cat, i) => `
  <div class="category-item">
   <span>${cat}</span>
   <button class="btn btn-danger" style="padding:5px 10px;font-size:12px;" onclick="deleteCategory(${i})">Delete</button>
  </div>
 `).join('');
}

window.addCategory = () => {
 const name = document.getElementById('newCategoryName').value.trim();
 if(!name) return alert('Enter category name');
 if(categories.includes(name)) return alert('Already exists');
 categories.push(name);
 set(ref(db, 'categories'), categories);
 document.getElementById('newCategoryName').value = '';
 renderCategoryList();
 updateCategorySelects();
};

window.deleteCategory = i => {
 if(!confirm('Delete?')) return;
 categories.splice(i, 1);
 set(ref(db, 'categories'), categories);
 renderCategoryList();
 updateCategorySelects();
};

window.exportPDF = () => {
 const grouped = {};
 products.forEach(p => {
  if(!grouped[p.category]) grouped[p.category] = [];
  grouped[p.category].push(p);
 });

 const html = `
<!DOCTYPE html>
<html>
<head>
 <title>Beste Distributor Catalog</title>
 <style>
  body{font-family:Arial,sans-serif;color:#333;line-height:1.6}
  .cover{page-break-after:always;text-align:center;padding:80px 40px;background:linear-gradient(135deg,#2b8a8a,#1e6b6b);color:#fff;min-height:100vh;display:flex;flex-direction:column;justify-content:center}
  .cover h1{font-size:48px;margin-bottom:20px}
  .cover p{font-size:18px;opacity:0.9;margin-bottom:10px}
  .category-title{font-size:22px;color:#2b8a8a;border-bottom:3px solid #2b8a8a;padding-bottom:10px;margin-bottom:20px;font-weight:bold}
  .product-row{display:flex;gap:15px;margin-bottom:20px;padding:15px;background:#f9f9f9;border-radius:6px;page-break-inside:avoid}
  .product-image{width:100px;height:100px;background:#f0f0f0;border-radius:6px;display:flex;align-items:center;justify-content:center;flex-shrink:0;overflow:hidden}
  .product-image img{width:100%;height:100%;object-fit:cover}
  .product-name{font-size:16px;font-weight:bold;color:#2b8a8a;margin-bottom:5px}
  .product-price{font-size:18px;font-weight:bold;color:#dc3545}
  .footer{text-align:center;margin-top:40px;font-size:12px;color:#999;border-top:1px solid #ddd;padding-top:20px}
 </style>
</head>
<body>
 <div class="cover">
  <h1>Beste Distributor</h1>
  <p>Product Catalog</p>
  <p style="margin-top:40px">Shop smarter, Save more, Delivered fast</p>
  <div style="margin-top:60px;font-size:13px">
   <p>(437) 260-0437</p>
   <p>bestedistributor.ca@gmail.com</p>
   <p>${new Date().toLocaleDateString()}</p>
  </div>
 </div>
 ${Object.keys(grouped).map(cat => `
  <div style="page-break-inside:avoid;margin-bottom:40px;padding:0 40px">
   <div class="category-title">${cat}</div>
   ${grouped[cat].map(p => `
    <div class="product-row">
     <div class="product-image">${p.image ? `<img src="${p.image}">` : '<div style="color:#999">No Image</div>'}</div>
     <div>
      <div class="product-name">${p.name}</div>
      <div class="product-price">$${p.price.toFixed(2)}</div>
      ${p.description ? `<div style="font-size:12px;color:#777;margin-top:8px">${p.description}</div>` : ''}
     </div>
    </div>
   `).join('')}
  </div>
 `).join('')}
 <div class="footer">
  <p>¬© ${new Date().getFullYear()} Beste Distributor. All rights reserved.</p>
 </div>
</body>
</html>
 `;

 const win = window.open();
 win.document.write(html);
 win.document.close();
 setTimeout(() => win.print(), 250);
};

window.exportCSV = () => {
 const headers = ['Name', 'Category', 'Price', 'Previous Price', 'Description'];
 const rows = products.map(p => [
  p.name,
  p.category || '',
  p.price,
  p.prevPrice || '',
  p.description || ''
 ]);

 const csv = [headers, ...rows].map(r => r.map(c => `"${c}"`).join(',')).join('\n');
 const blob = new Blob([csv], {type: 'text/csv'});
 const url = URL.createObjectURL(blob);
 const a = document.createElement('a');
 a.href = url;
 a.download = `Beste_Catalog_${new Date().toISOString().split('T')[0]}.csv`;
 a.click();
};

window.importCSV = () => {
 document.getElementById('csvInput').click();
};

window.handleCSVImport = () => {
 const file = document.getElementById('csvInput').files[0];
 if(!file) return;

 const reader = new FileReader();
 reader.onload = e => {
  const lines = e.target.result.split('\n');
  const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));

  for(let i = 1; i < lines.length; i++){
   if(!lines[i].trim()) continue;
   const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
   const prod = {};

   headers.forEach((h, idx) => {
    const val = values[idx] || '';
    if(h.toLowerCase() === 'name') prod.name = val;
    else if(h.toLowerCase() === 'category') prod.category = val;
    else if(h.toLowerCase() === 'price') prod.price = parseFloat(val) || 0;
    else if(h.toLowerCase().includes('previous')) prod.prevPrice = parseFloat(val) || null;
    else if(h.toLowerCase() === 'description') prod.description = val;
   });

   if(prod.name){
    set(ref(db, `products/${Date.now()}_${i}`), {...prod, image: ''});
   }
  }

  document.getElementById('csvInput').value = '';
  alert('Products imported!');
 };
 reader.readAsText(file);
};

function updateSyncStatus(status){
 const el = document.getElementById('syncStatus');
 if(status === 'Synced'){
  el.textContent = '‚úì Synced';
  el.className = 'sync-status synced';
 } else if(status === 'Syncing'){
  el.textContent = '‚ü≥ Syncing...';
  el.className = 'sync-status syncing';
 } else {
  el.textContent = '‚ö†Ô∏è Error';
  el.className = 'sync-status error';
 }
}
</script>

</body>
</html>
