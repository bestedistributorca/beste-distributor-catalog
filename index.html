<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Beste Distributor – Product Catalog</title>

<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:system-ui,-apple-system,Segoe UI,Roboto;background:#f5f5f5;color:#333}
header{background:linear-gradient(135deg,#2b8a8a,#1e6b6b);color:#fff;padding:24px;text-align:center}
header h1{font-size:28px}
header p{opacity:.9;margin-top:6px}
.container{max-width:1200px;margin:24px auto;padding:0 16px}

.toolbar{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-bottom:20px}
button{cursor:pointer;border:none;border-radius:6px;padding:10px 16px;font-weight:600}
.primary{background:#2b8a8a;color:#fff}
.secondary{background:#fff;border:2px solid #2b8a8a;color:#2b8a8a}
.danger{background:#dc3545;color:#fff}

.filters{display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap}
input,select,textarea{padding:10px;border-radius:6px;border:1px solid #ccc;width:100%}

.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:20px}
.card{background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,.1)}
.card img{width:100%;height:180px;object-fit:cover;background:#eee}
.card .info{padding:14px}
.card h3{color:#2b8a8a;margin-bottom:6px}
.price{font-size:20px;font-weight:700;color:#2b8a8a}
.old{color:#999;text-decoration:line-through;font-size:14px}
.badge{background:#28a745;color:#fff;font-size:11px;padding:3px 6px;border-radius:4px;margin-left:6px}
.actions{display:flex;gap:6px;margin-top:10px}
.actions button{flex:1;font-size:12px}

.modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center}
.modal.active{display:flex}
.modal-box{background:#fff;padding:20px;border-radius:8px;width:90%;max-width:480px;max-height:90vh;overflow:auto}
.modal-box h2{margin-bottom:14px;color:#2b8a8a}
.form-group{margin-bottom:12px}

@media(max-width:600px){
 header h1{font-size:22px}
}
</style>
</head>

<body>

<header>
  <h1>Beste Distributor</h1>
  <p>Shop smarter • Save more • Delivered fast</p>
</header>

<div class="container">

<div class="toolbar">
  <button class="primary" onclick="openModal()">+ Add Product</button>
  <button class="secondary" onclick="openCategories()">Manage Categories</button>
  <button class="secondary" onclick="exportCatalog()">Export Professional Catalog</button>
</div>

<div class="filters">
  <input id="search" placeholder="Search products..." oninput="render()">
  <select id="categoryFilter" onchange="render()">
    <option value="">All Categories</option>
  </select>
</div>

<div class="grid" id="grid"></div>

</div>

<!-- PRODUCT MODAL -->
<div class="modal" id="productModal">
<div class="modal-box">
<h2 id="modalTitle">Add Product</h2>

<div class="form-group">
<input id="name" placeholder="Product name">
</div>

<div class="form-group">
<select id="category"></select>
</div>

<div class="form-group">
<input id="price" type="number" placeholder="Price">
</div>

<div class="form-group">
<input id="prevPrice" type="number" placeholder="Previous price (optional)">
</div>

<div class="form-group">
<textarea id="desc" placeholder="Description"></textarea>
</div>

<div class="form-group">
<input type="file" id="image">
</div>

<div class="actions">
<button class="primary" onclick="save()">Save</button>
<button onclick="closeModal()">Cancel</button>
</div>
</div>
</div>

<!-- CATEGORY MODAL -->
<div class="modal" id="catModal">
<div class="modal-box">
<h2>Categories</h2>
<div id="catList"></div>
<input id="newCat" placeholder="New category">
<div class="actions">
<button class="primary" onclick="addCategory()">Add</button>
<button onclick="closeCategories()">Done</button>
</div>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getDatabase, ref, onValue, set, remove } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";
import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-storage.js";

const firebaseConfig = {
 apiKey: "AIzaSyBK9-eeQ0E7ovI88jcmk9aa10GWpI9V30U",
 authDomain: "beste-distributor.firebaseapp.com",
 databaseURL: "https://beste-distributor-default-rtdb.firebaseio.com",
 projectId: "beste-distributor",
 storageBucket: "beste-distributor.firebasestorage.app",
 messagingSenderId: "384320855826",
 appId: "1:384320855826:web:349cfb70dae242f0f19dcb"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const storage = getStorage(app);

let products=[], categories=[], editing=null;

onValue(ref(db,"products"),s=>{
 products=[];
 s.forEach(c=>products.push({id:c.key,...c.val()}));
 render();
});

onValue(ref(db,"categories"),s=>{
 categories=s.exists()?s.val():["Beverages","Snacks","Grocery"];
 set(ref(db,"categories"),categories);
 updateCats();
});

window.render=()=>{
 const grid=document.getElementById("grid");
 const q=document.getElementById("search").value.toLowerCase();
 const cat=document.getElementById("categoryFilter").value;
 grid.innerHTML="";
 products.filter(p=>
  (!q||p.name.toLowerCase().includes(q)) &&
  (!cat||p.category===cat)
 ).forEach(p=>{
  grid.innerHTML+=`
  <div class="card">
   <img src="${p.image||''}">
   <div class="info">
    <h3>${p.name}</h3>
    ${p.prevPrice?`<div class="old">$${p.prevPrice}</div>`:""}
    <div class="price">$${p.price} ${p.prevPrice?'<span class="badge">DISCOUNT</span>':''}</div>
    <p>${p.description||""}</p>
    <div class="actions">
     <button onclick="edit('${p.id}')">Edit</button>
     <button class="danger" onclick="del('${p.id}')">Delete</button>
    </div>
   </div>
  </div>`;
 });
};

window.openModal=()=>{editing=null;document.getElementById("productModal").classList.add("active")}
window.closeModal=()=>document.getElementById("productModal").classList.remove("active")

window.save=async()=>{
 const data={
  name:name.value,
  category:category.value,
  price:+price.value,
  prevPrice:prevPrice.value?+prevPrice.value:null,
  description:desc.value,
  image:""
 };
 if(image.files[0]){
  const r=sRef(storage,"products/"+Date.now()+"_"+image.files[0].name);
  await uploadBytes(r,image.files[0]);
  data.image=await getDownloadURL(r);
 }
 set(ref(db,"products/"+(editing||Date.now())),data);
 closeModal();
};

window.edit=id=>{
 const p=products.find(x=>x.id===id);
 editing=id;
 name.value=p.name;category.value=p.category;
 price.value=p.price;prevPrice.value=p.prevPrice||"";
 desc.value=p.description||"";
 openModal();
};

window.del=id=>confirm("Delete?")&&remove(ref(db,"products/"+id));

window.openCategories=()=>{catModal.classList.add("active");renderCats()}
window.closeCategories=()=>catModal.classList.remove("active")
window.addCategory=()=>{categories.push(newCat.value);set(ref(db,"categories"),categories);newCat.value=""}

function updateCats(){
 category.innerHTML=categories.map(c=>`<option>${c}</option>`).join("");
 categoryFilter.innerHTML='<option value="">All Categories</option>'+categories.map(c=>`<option>${c}</option>`).join("");
}

function renderCats(){
 catList.innerHTML=categories.map((c,i)=>`<div>${c} <button onclick="categories.splice(${i},1);set(ref(db,'categories'),categories)">X</button></div>`).join("");
}

window.exportCatalog=()=>window.print();
</script>

</body>
</html>
